# TestRunner

A MATLAB class for validating student code submissions. The TestRunner class provides a comprehensive suite of validation methods to check function outputs, calls, plots, images, text files, and more. It is designed as an extension to MATLAB's unit testing framework.

The class is designed for use with the CS1371 autograder. View the repository [here](https://github.com/ekim493/cs1371-autograder).

## Basic Usage
To use the class, place all associated files in your MATLAB path. It is recommended you use a class folder by placing all your files in `@TestRunner/<All repo files>`.

The TestRunner runs off of a reference solution. This allows test cases to be unique and randomized, if desired. Place student and solution code into namespace folders, prefixed with a plus sign.

```
baseDirectory/
├── +student/
│   └── myFunction.m
└── +solution/
    └── myFunction.m (or myFunction.p)
```

To create a test case which uses the TestRunner, create a class that inherits the `matlab.unittest.TestCase` and within test functions create an instance of the class. The inputs to the constructor should be the inputs to the function being tested. For example, if the function would normally be called like `out = myFunction(x, y)`, create the object by calling `t = TestRunner(x, y)`. By default, the function name is retrieved as the prefix of the test function name (`FUNCNAME_Test#`). Run the tester by calling the `run()` function.

```
classdef ExampleTester < matlab.unittest.TestCase
    methods(Test)
        function myFunction_Test1(testCase)
            % Inputs
            x = 2;
            y = 3;
            % Run Tester
            t = TestRunner(x, y);
            t.run();
        end
    end
end
```

## Properties

The following are a list of properties relevant to the TestRunner class. You can set them as name-value arguments or using the dot notation.
```
runner = TestRunner(input1, input2, RunCheckImages='myImg.png');
runner.IncludeFuncs = {'FOR', 'IF'};
runner.run();
```

### Validation Checks
Toggle which validation checks to run. 

- `RunCheckAllEqual` (default: `true`): Compare all outputs (when running a function) or variables (when running a script). The type will be auto-detected. Set to true or false.
- `RunCheckCalls` (default: `true`): Check a function's calls for banned functions. The list is set by the file defined by the `ValidFunctionList` property. Set to true or false.
- `RunCheckFilesClosed` (default: `true`): Check if all files have been properly closed. Set to true or false. 
- `RunCheckImages` (default: `''`): Validate image outputs. Set to the image filename to check (empty = skip). 
- `RunCheckPlots` (default: `false`): Validate plot outputs.
- `RunCheckTextFiles` (default: `''`): Validate text file outputs. Set to the filename to check (empty = skip).

### Behavior Modifiers

- `CheckedVariables` (default: `{}`):  Script variables to check. By default, if this variable is empty when running checkAllEqual on a script, all variables generated by the solution script will be checked. For example, if the solution script has `A = 3`, it will look for the variable A and check if that value is 3 in the student script. If you do not want to check all variables, clear them in the script or specify the variables you want to check as a cell array (ex. `{'A'}`).

- `OutputType` (default: `'full'`): Amount of information displayed in the output. Set to `'full'` (comparison between actual and expected outputs), `'limit'` (shows only which variables are incorrect), or `'none'` (no output).
- `NumTolerance` (default: `0.001`): Absolute tolerance for numerical comparisons in checkAllEqual.
- `ImageTolerance` (default: `10`): Tolerance for image pixel difference (RGB value).
- `TextRule` (default: `'default'`): Text comparison strictness. Set to `'default'` (ignores extra newline), `'strict'` (must be identical), or `'loose'` (ignore newline and capitalization).

### Function Call Restrictions

List functions as a cell array of characters. Operations, which are defined as the keywords that appear when the `iskeyword` function is called, must be in all caps.

- `ValidFunctionList` (default: `'Function_List.json'`): JSON file with allowed/disabled functions.
- `AllowedFuncs` (default: `{}`): Functions that are allowed to be used, regardless of whether it is in the allowed function list.
- `BannedFuncs` (default: `{}`): Functions that are banned, regardless of whether it is in the allowed function list.
- `IncludeFuncs` (default: `{}`): Required functions that must be used.

### Display Customization

- `OutputNames`: Names of output variables (defaults to `'output#'`).
- `FailureMessage`: Custom message to display on test failure.

### Additional Properties
- `FunctionName`: Name of the function to test. By default, this is set to the prefix of the test function name (`FUNCNAME_Test#`, where `FUNCNAME` is the name of the function being tested).
- `TestCase`: The MATLAB test case object (automatically retrieved if not provided).
- `InputNames`: Names of input variables. Attempts to retrieve it from the caller workspace. Defaults to `input#` if in-line inputs used.

## Additional Notes
- You can view additional examples of test cases in the CS1371 autograder repository [here](https://github.com/ekim493/cs1371-autograder).
- When using checkPlots:
    - All figures must be closed (using `close all`) before creating the test plots.
    - The solution plot must be created first, then student plot.
    - Use `figure` to create separate plot windows.
    - The above is handled automatically if using the autograder.
    - Note: checkPlots does not support multiple figures, annotations, tiled layout, and plots generated without using the `plot()` function (e.g. colorbars, scatter, 3D).
- When using checkImages or checkTextFiles:
    - If the file output defined by `RunCheckImages` or `RunCheckTextFiles` is generated by the solution, it will be moved to a temporary directory.
    - Alternatively, the solution code can be adjusted to output a file with the suffix _soln. For example, if the output file that should be created by the student and checked is `myImage.png`, the solution code should create an image to `myImage_soln.png`.
- The TestRunner uses two unique error identifiers:
    - `TestRunner`: Setup or configuration errors
    - `HWStudent`: Student code errors
